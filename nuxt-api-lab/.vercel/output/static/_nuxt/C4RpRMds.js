import{e as W,B as U,C as $,D as z,i as G,A as N,E as j,p as x,F as q,G as Y,r as L,H as R,I as J,J as Q,s as p,K as X,z as Z,L as T,g as K,c as P,a as m,t as M,n as k,o as O}from"./BxqDI8qG.js";import{c as ee}from"./C7BYr_Dn.js";const ae={trailing:!0};function te(e,a=25,i={}){if(i={...ae,...i},!Number.isFinite(a))throw new TypeError("Expected `wait` to be a finite number");let r,t,g=[],s,n;const h=(d,D)=>(s=ne(e,d,D),s.finally(()=>{if(s=null,i.trailing&&n&&!t){const b=h(d,n);return n=null,b}}),s),f=function(...d){return i.trailing&&(n=d),s||new Promise(D=>{const b=!t&&i.leading;clearTimeout(t),t=setTimeout(()=>{t=null;const c=i.leading?r:h(this,d);n=null;for(const _ of g)_(c);g=[]},a),b?(r=h(this,d),D(r)):g.push(D)})},o=d=>{d&&(clearTimeout(d),t=null)};return f.isPending=()=>!!t,f.cancel=()=>{o(t),g=[],n=null},f.flush=()=>{if(o(t),!n||s)return;const d=n;return n=null,h(this,d)},f}async function ne(e,a,i){return await e.apply(a,i)}function se(...e){const a=typeof e[e.length-1]=="string"?e.pop():void 0;re(e[0],e[1])&&e.unshift(a);let[i,r,t={}]=e,g=!1;const s=x(()=>Z(i));if(typeof s.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof r!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const n=W();t.server??=!0,t.default??=ie,t.getCachedData??=A,t.lazy??=!1,t.immediate??=!0,t.deep??=U.deep,t.dedupe??="cancel",t._functionName,n._asyncData[s.value];function h(){const c={cause:"initial",dedupe:t.dedupe};return n._asyncData[s.value]?._init||(c.cachedData=t.getCachedData(s.value,n,{cause:"initial"}),n._asyncData[s.value]=I(n,s.value,r,t,c.cachedData)),()=>n._asyncData[s.value].execute(c)}const f=h(),o=n._asyncData[s.value];o._deps++;const d=t.server!==!1&&n.payload.serverRendered;{let c=function(u){const l=n._asyncData[u];l?._deps&&(l._deps--,l._deps===0&&l?._off())};const _=q();if(_&&d&&t.immediate&&!_.sp&&(_.sp=[]),_&&!_._nuxtOnBeforeMountCbs){_._nuxtOnBeforeMountCbs=[];const u=_._nuxtOnBeforeMountCbs;$(()=>{u.forEach(l=>{l()}),u.splice(0,u.length)}),z(()=>u.splice(0,u.length))}const w=_&&(_._nuxtClientOnly||G(ee,!1));d&&n.isHydrating&&(o.error.value||o.data.value!==void 0)?o.status.value=o.error.value?"error":"success":_&&(!w&&n.payload.serverRendered&&n.isHydrating||t.lazy)&&t.immediate?_._nuxtOnBeforeMountCbs.push(f):t.immediate&&o.status.value!=="success"&&f();const v=Y(),y=N(s,(u,l)=>{if((u||l)&&u!==l){g=!0;const B=n._asyncData[l]?.data.value!==void 0,H=n._asyncDataPromises[l]!==void 0,F={cause:"initial",dedupe:t.dedupe};if(!n._asyncData[u]?._init){let E;l&&B?E=n._asyncData[l].data.value:(E=t.getCachedData(u,n,{cause:"initial"}),F.cachedData=E),n._asyncData[u]=I(n,u,r,t,E)}n._asyncData[u]._deps++,l&&c(l),(t.immediate||B||H)&&n._asyncData[u].execute(F),T(()=>{g=!1})}},{flush:"sync"}),C=t.watch?N(t.watch,()=>{g||(n._asyncData[s.value]?._execute.isPending()&&T(()=>{n._asyncData[s.value]?._execute.flush()}),n._asyncData[s.value]?._execute({cause:"watch",dedupe:t.dedupe}))}):()=>{};v&&j(()=>{y(),C(),c(s.value)})}const D={data:S(()=>n._asyncData[s.value]?.data),pending:S(()=>n._asyncData[s.value]?.pending),status:S(()=>n._asyncData[s.value]?.status),error:S(()=>n._asyncData[s.value]?.error),refresh:(...c)=>n._asyncData[s.value]?._init?n._asyncData[s.value].execute(...c):h()(),execute:(...c)=>D.refresh(...c),clear:()=>{const c=n._asyncData[s.value];if(c?._abortController)try{c._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{c._abortController=void 0}V(n,s.value)}},b=Promise.resolve(n._asyncDataPromises[s.value]).then(()=>D);return Object.assign(b,D),b}function S(e){return x({get(){return e()?.value},set(a){const i=e();i&&(i.value=a)}})}function re(e,a){return!(typeof e=="string"||typeof e=="object"&&e!==null||typeof e=="function"&&typeof a=="function")}function V(e,a){a in e.payload.data&&(e.payload.data[a]=void 0),a in e.payload._errors&&(e.payload._errors[a]=void 0),e._asyncData[a]&&(e._asyncData[a].data.value=p(e._asyncData[a]._default()),e._asyncData[a].error.value=void 0,e._asyncData[a].status.value="idle"),a in e._asyncDataPromises&&(e._asyncDataPromises[a]=void 0)}function oe(e,a){const i={};for(const r of a)i[r]=e[r];return i}function I(e,a,i,r,t){e.payload._errors[a]??=void 0;const g=r.getCachedData!==A,s=i,n=r.deep?L:R,h=t!==void 0,f=e.hook("app:data:refresh",async d=>{(!d||d.includes(a))&&await o.execute({cause:"refresh:hook"})}),o={data:n(h?t:r.default()),pending:x(()=>o.status.value==="pending"),error:X(e.payload._errors,a),status:R("idle"),execute:(...d)=>{const[D,b=void 0]=d,c=D&&b===void 0&&typeof D=="object"?D:{};if(e._asyncDataPromises[a]&&(c.dedupe??r.dedupe)==="defer")return e._asyncDataPromises[a];{const v="cachedData"in c?c.cachedData:r.getCachedData(a,e,{cause:c.cause??"refresh:manual"});if(v!==void 0)return e.payload.data[a]=o.data.value=v,o.error.value=void 0,o.status.value="success",Promise.resolve(v)}o._abortController&&o._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),o._abortController=new AbortController,o.status.value="pending";const _=new AbortController,w=new Promise((v,y)=>{try{const C=c.timeout??r.timeout,u=ce([o._abortController?.signal,c?.signal],_.signal,C);if(u.aborted){const l=u.reason;y(l instanceof Error?l:new DOMException(String(l??"Aborted"),"AbortError"));return}return u.addEventListener("abort",()=>{const l=u.reason;y(l instanceof Error?l:new DOMException(String(l??"Aborted"),"AbortError"))},{once:!0,signal:_.signal}),Promise.resolve(s(e,{signal:u})).then(v,y)}catch(C){y(C)}}).then(async v=>{let y=v;r.transform&&(y=await r.transform(v)),r.pick&&(y=oe(y,r.pick)),e.payload.data[a]=y,o.data.value=y,o.error.value=void 0,o.status.value="success"}).catch(v=>{if(e._asyncDataPromises[a]&&e._asyncDataPromises[a]!==w||o._abortController?.signal.aborted)return e._asyncDataPromises[a];if(typeof DOMException<"u"&&v instanceof DOMException&&v.name==="AbortError")return o.status.value="idle",e._asyncDataPromises[a];o.error.value=Q(v),o.data.value=p(r.default()),o.status.value="error"}).finally(()=>{_.abort(),delete e._asyncDataPromises[a]});return e._asyncDataPromises[a]=w,e._asyncDataPromises[a]},_execute:te((...d)=>o.execute(...d),0,{leading:!0}),_default:r.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{f(),e._asyncData[a]?._init&&(e._asyncData[a]._init=!1),g||J(()=>{e._asyncData[a]?._init||(V(e,a),o.execute=()=>Promise.resolve())})}};return o}const ie=()=>{},A=(e,a,i)=>{if(a.isHydrating)return a.payload.data[e];if(i.cause!=="refresh:manual"&&i.cause!=="refresh:hook")return a.static.data[e]};function ce(e,a,i){const r=e.filter(s=>!!s);if(typeof i=="number"&&i>=0){const s=AbortSignal.timeout?.(i);s&&r.push(s)}if(AbortSignal.any)return AbortSignal.any(r);const t=new AbortController;for(const s of r)if(s.aborted){const n=s.reason??new DOMException("Aborted","AbortError");try{t.abort(n)}catch{t.abort()}return t.signal}const g=()=>{const n=r.find(h=>h.aborted)?.reason??new DOMException("Aborted","AbortError");try{t.abort(n)}catch{t.abort()}};for(const s of r)s.addEventListener?.("abort",g,{once:!0,signal:a});return t.signal}function le(e){const{data:a,pending:i,error:r}=se(`agro-weather-${e.polygonId}-${e.start}-${e.end}`,async()=>(await $fetch("/api/agro/weather",{params:{polygon_id:e.polygonId,start:e.start,end:e.end}})).data,{immediate:!!e.polygonId});return{data:a,pending:i,error:r}}const ue={class:"p-8 space-y-6"},de={key:0,class:"text-gray-500"},fe={key:1,class:"text-red-600"},_e={key:2},ge={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ve={class:"p-4 bg-white shadow rounded"},he={class:"text-2xl font-semibold"},De={class:"p-4 bg-white shadow rounded"},ye={class:"text-2xl font-semibold"},me={class:"mt-6 bg-gray-100 p-4 rounded text-xs overflow-auto"},Ce=K({__name:"agriculture",setup(e){const a=L("YOUR_POLYGON_ID_HERE"),i=Math.floor(Date.now()/1e3),r=i-10080*60,{data:t,pending:g,error:s}=le({polygonId:a.value,start:r,end:i}),n=x(()=>!t.value||t.value.length===0?null:(t.value.reduce((f,o)=>f+o.temp.average,0)/t.value.length).toFixed(1));return(h,f)=>(O(),P("div",ue,[f[2]||(f[2]=m("h1",{class:"text-3xl font-bold"},"ðŸŒ± Agriculture Dashboard",-1)),p(g)?(O(),P("div",de,"Loading agro weather data...")):p(s)?(O(),P("div",fe,"Failed to load data")):p(t)?(O(),P("div",_e,[m("div",ge,[m("div",ve,[f[0]||(f[0]=m("p",{class:"text-sm text-gray-500"},"Avg temperature",-1)),m("p",he,M(n.value)+" Â°C",1)]),m("div",De,[f[1]||(f[1]=m("p",{class:"text-sm text-gray-500"},"Days",-1)),m("p",ye,M(p(t).length),1)])]),m("pre",me,M(p(t))+`
      `,1)])):k("",!0)]))}});export{Ce as default};
